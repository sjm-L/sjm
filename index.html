<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>FCM ì•Œë¦¼ í…ŒìŠ¤íŠ¸</title>

    <!-- âœ… PWA ê´€ë ¨ ë©”íƒ€ íƒœê·¸ ì¶”ê°€ -->
    <link rel="manifest" href="/manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="theme-color" content="#ffffff" />
  </head>
  <body>
    <h1>ğŸ“¢ ì•Œë¦¼ í…ŒìŠ¤íŠ¸</h1>
    <button id="pushBtn">ì•Œë¦¼ ê¶Œí•œ ìš”ì²­</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getMessaging,
        getToken,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDcIGVTaeZOMYO7n6fWIzfyL0JnWYb8atA",
        authDomain: "sjml-18f14.firebaseapp.com",
        projectId: "sjml-18f14",
        storageBucket: "sjml-18f14.firebasestorage.app",
        messagingSenderId: "937757609525",
        appId: "1:937757609525:web:3f8b13a84fe9792b19eb7c",
        measurementId: "G-3LX485Q094",
      };

      const app = initializeApp(firebaseConfig);
      const messaging = getMessaging(app);

      const registerServiceWorkerAndGetToken = async () => {
        try {
          const registration = await navigator.serviceWorker.register(
            "/firebase-messaging-sw.js"
          );
          console.log("âœ… ì„œë¹„ìŠ¤ì›Œì»¤ ë“±ë¡ ì„±ê³µ");

          const permission = await Notification.requestPermission();
          if (permission !== "granted") {
            alert("ğŸ“‹ í˜„ì¬ ê¶Œí•œ ìƒíƒœ: " + permission);
            return;
          }

          const token = await getToken(messaging, {
            vapidKey:
              "BJHlIFtaDRwKqCFrpo8LzNgThJmjkXXZAxuivcvObj6uARpv2RwPksQRq5nzBmVVKLBr_QefRSRRMq7rGdYb1eA",
            serviceWorkerRegistration: registration,
          });

          console.log("âœ… í† í°:", token);
          alert("ğŸ“² í‘¸ì‹œ í† í°:\n" + token);
        } catch (err) {
          console.error("ğŸ’¥ ì˜¤ë¥˜ ë°œìƒ:", err);
          alert("ğŸ’¥ ì˜¤ë¥˜: " + err.message);
        }
      };

      document
        .getElementById("pushBtn")
        .addEventListener("click", registerServiceWorkerAndGetToken);
    </script>
  </body>
</html>
