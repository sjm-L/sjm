<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>FCM 알림 테스트</title>
  </head>
  <body>
    <h1>📢 알림 테스트</h1>
    <button id="pushBtn">알림 권한 요청</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getMessaging,
        getToken,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDcIGVTaeZOMYO7n6fWIzfyL0JnWYb8atA",
        authDomain: "sjml-18f14.firebaseapp.com",
        projectId: "sjml-18f14",
        storageBucket: "sjml-18f14.firebasestorage.app",
        messagingSenderId: "937757609525",
        appId: "1:937757609525:web:289106dbbccafb6119eb7c",
        measurementId: "G-HEMV4LTQQB",
      };

      const app = initializeApp(firebaseConfig);
      const messaging = getMessaging(app);

      const registerServiceWorkerAndGetToken = async () => {
        try {
          const registration = await navigator.serviceWorker.register(
            "/firebase-messaging-sw.js"
          );
          console.log("✅ 서비스워커 등록 성공");

          const permission = await Notification.requestPermission();
          if (permission !== "granted") {
            alert("❌ 알림 권한이 거부되었습니다.");
            return;
          }

          const token = await getToken(messaging, {
            vapidKey:
              "BJHlIFtaDRwKqCFrpo8LzNgThJmjkXXZAxuivcvObj6uARpv2RwPksQRq5nzBmVVKLBr_QefRSRRMq7rGdYb1eA",
            serviceWorkerRegistration: registration,
          });

          console.log("✅ 토큰:", token);
          alert("📲 푸시 토큰:\n" + token);
        } catch (err) {
          console.error("💥 오류 발생:", err);
          alert("💥 오류: " + err.message);
        }
      };

      document
        .getElementById("pushBtn")
        .addEventListener("click", registerServiceWorkerAndGetToken);
    </script>
  </body>
</html>
